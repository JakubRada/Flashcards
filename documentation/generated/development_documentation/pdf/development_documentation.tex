\documentclass[12pt]{article}
\usepackage[a4paper, total={18cm, 25cm}]{geometry}
\usepackage[utf8]{inputenc}
\usepackage[czech]{babel}
\usepackage[parfill]{parskip}
\usepackage[hidelinks]{hyperref}
\usepackage{xcolor}
\providecommand{\tightlist}{\setlength{\itemsep}{1pt}\setlength{\parskip}{1pt}}

\definecolor{codehighlight}{RGB}{28,93,153}
\let\oldtexttt\texttt
\renewcommand{\texttt}[1]{\oldtexttt{\textcolor{codehighlight}{#1}}}

\begin{document}
\begin{center}
  \textbf{\Huge Flashcards}\\
  \vspace{0.2cm}
  \rule{\textwidth}{0.5pt}
\end{center}
\tableofcontents
\begin{center}
  \rule{\textwidth}{0.5pt}
\end{center}
\hypertarget{pux159ehled}{%
\section{Přehled}\label{pux159ehled}}

Aplikace Flashcards má stejnou strukturu jako webová aplikace, hlavní
části jsou naprogramovány s použitím HTML, CSS a Javascriptu, ale na
rozdíl od ostatních webových aplikací se nevykresluje ve webovém
prohlížeči, ale v Electronu. Data se ukládají do oddělené databáze,
takže obě části aplikace běží nezávisle na sobě. O databázi se stará
Django Framework (Python) a běží to na localhostu. Klient a server
komunikují asynchronně skrz JSON requesty.

\hypertarget{pouux17eituxe9-knihovny}{%
\section{Použité knihovny}\label{pouux17eituxe9-knihovny}}

Aplikace používá mnoho různých knihoven na usnadnění používání některých
funkcí. Na serverové části je použito Django, které ovšem vyžaduje
nainstalovaný Python 3 (je doporučeno používat nejnovější verzi). Na
straně klienta je použit Electron, který renderuje všechny vizuální
aspekty místo prohlížeče, a ten pro své fungování potřebuje Node.js. Pro
hezčí vzhled je použit Bootstrap, skládá se ze tří souborů:
\texttt{.css}, které je upravené kvůli sladění některých barev s
celkovým vzhledem, \texttt{.js} a \texttt{popper.js}, které jsou potřeba
pro některé funkce. Pro dynamické měnění obsahu na stránce a komunikaci
se serverem je použita JQuery.

\begin{itemize}
\tightlist
\item
  Server

  \begin{itemize}
  \tightlist
  \item
    Python 3.7 nebo vyšší (\emph{www.python.org/downloads/windows})
  \item
    Django 2.1.5 (nainstalováno příkazem
    \texttt{pip\ install\ Django==2.1.5})
  \end{itemize}
\item
  Uživatelské rozhraní

  \begin{itemize}
  \tightlist
  \item
    Node.js (\emph{www.npmjs.com/get-npm})
  \item
    Electron (\emph{www.electronjs.org})
  \item
    Electron packager
  \item
    Bootstrap předkompilované soubory (stažené z
    \emph{www.getbootstrap.com/docs/4.3/getting-started/download/})

    \begin{itemize}
    \tightlist
    \item
      CSS, Javascript a Popper
    \end{itemize}
  \item
    JQuery (\emph{www.jquery.com})
  \end{itemize}
\end{itemize}

\hypertarget{konfigurace-serveru}{%
\section{Konfigurace serveru}\label{konfigurace-serveru}}

Jak bylo zmíněno dříve, o všechna ukládaná data se stará Django běžící
offline na localhostu na portu 8000. Všechny soubory týkající se serveru
se nachází ve složce \texttt{./server/}. Ve složce
\texttt{./server/server} je obecné nastavení serverové aplikace, ve
složce \texttt{./server/cards/} jsou pak soubory této konkrétní aplikace
s modely pro databázi a funkcemi na zpracovávání příchozích a odchozích
requestů.

\hypertarget{spuux161tux11bnuxed-serveru}{%
\subsection{Spuštění serveru}\label{spuux161tux11bnuxed-serveru}}

~~~~\texttt{python\ manage.py\ runserver\ localhost:8000}

\begin{itemize}
\tightlist
\item
  Spuštěn ze složky, ve které se nachází soubor \texttt{manage.py}
  (\texttt{./server/})
\end{itemize}

\hypertarget{zuxe1kladnuxed-nastavenuxed-serveru}{%
\subsection{Základní nastavení
serveru}\label{zuxe1kladnuxed-nastavenuxed-serveru}}

\begin{itemize}
\tightlist
\item
  Soubory v \texttt{./server/server}.
\item
  Zde se nastavují všechny nainstalované aplikace využívající tento
  server (v tomto případě pouze `cards'), typ použité databáze
  (`sqlite3') a které urls jsou použity pro příjímání requestů
  (\texttt{urls.py}).
\item
  Dále se zde nachází secret key pro případ publikování databáze na
  internet
\end{itemize}

\hypertarget{nastavenuxed-aplikace-cards}{%
\subsection{Nastavení aplikace
Cards}\label{nastavenuxed-aplikace-cards}}

Všechny soubory v \texttt{./server/cards/}. Pro tuto aplikaci jsou
potřebné pouze \texttt{models.py}, \texttt{urls.py} a \texttt{views.py}.
Ostatní jsou buď automaticky vytvořené, nebo prázdné.

Základní adresa k serveru

~~~~\texttt{localhost:8000/cards}

\hypertarget{modely}{%
\subsubsection{Modely}\label{modely}}

V tomto souboru se definují databázové objekty s jejich proměnnými a
vztahy s ostatními objekty. Každý model slouží jako šablona pro záznamy
do databáze a vytvoří si tabulku, kam tyto záznamy budou ukládány.
Jednotlivé řádky tabulky jsou propojovány s jinými tabulkami skrze
relationship fields.

\begin{itemize}
\tightlist
\item
  model \texttt{Tag(tag\_name,\ previous\_success\_rate,\ card\_count)}
  \ldots{} šablona pro okruhy

  \begin{itemize}
  \tightlist
  \item
    \texttt{tag\_name} \ldots{} CharField (max. 100 znaků); reprezentuje
    jméno daného okruhu
  \item
    \texttt{previous\_success\_rate} \ldots{} IntegerField; reprezentuje
    procentuální úspěšnost posledního testu daného okruhu
  \item
    \texttt{card\_count} \ldots{} IntegerField, volitelný (default=0);
    reprezentuje počet karet propojených k okruhu
  \item
    každá proměnná má svoje \texttt{get} a \texttt{set}, které vrací,
    nebo upravují jejich hodnoty
  \item
    \texttt{add\_card} a \texttt{remove\_card} metody slouží k navýšení,
    nebo snížení počtu karet v \texttt{card\_count} proměnné
  \end{itemize}
\item
  model \texttt{Card(card\_front,\ card\_back,\ tag\_count,\ tags)}
  \ldots{} šablona pro kartičky

  \begin{itemize}
  \tightlist
  \item
    \texttt{card\_front} \ldots{} CharField (max. 200 znaků);
    reprezentuje text zobrazený na přední straně kartičky
  \item
    \texttt{card\_back} \ldots{} CharField (max. 200 znaků);
    reprezentuje text zobrazený na zadní straně kartičky
  \item
    \texttt{tag\_count} \ldots{} IntegerField, volitelný (default=0);
    reprezentuje počet okruhů, ve kterých je daná kartička
  \item
    \texttt{tags} \ldots{} ManyToManyField; propojuje kartičky s
    libovolným počtem okruhů

    \begin{itemize}
    \tightlist
    \item
      příkazem \texttt{tags.add(tag)} je propojena kartička s okruhem,
      \texttt{tags.remove(tag)} zničí vazbu mezi nimi
    \item
      v každém okruhu se automaticky vytvoří proměnná \texttt{cards},
      kam se naopak ukládají všechny propojené kartičky. To znamená, že
      jejich spojení je oboustranné a lze k nim přistoupit z obou dvou.
    \end{itemize}
  \item
    každá proměnná má svoje \texttt{get} a \texttt{set}, které vrací,
    nebo upravují jejich hodnoty
  \item
    \texttt{add\_tag} a \texttt{remove\_tag} metody slouží ke zvýšení,
    nebo snížení počtu okruhů v \texttt{tag\_count} proměnné
  \end{itemize}
\end{itemize}

\hypertarget{views-a-urls}{%
\subsubsection{Views a Urls}\label{views-a-urls}}

Zde jsou definovány funkce, které spravují příchozí a odchozí JSON a
Http requesty z/do klienta. Všechna data posílaná requesty jsou v JSON
formátu pro lepší komunikaci s Javascriptem.

\begin{itemize}
\tightlist
\item
  request \texttt{cards}

  \begin{itemize}
  \tightlist
  \item
    musí být poslán na url \texttt{localhost:8000/cards/cards}
  \item
    vrací seznam JSON objektů, každý reprezentuje jednu kartičku z
    databáze
  \item
    JSON objekt neobsahuje všechny atributy kartičky -
    \texttt{\{id,\ card\_front,\ card\_back\}}
  \end{itemize}
\item
  request \texttt{tags}

  \begin{itemize}
  \tightlist
  \item
    musí být poslán na url \texttt{localhost:8000/cards/tags}
  \item
    vrací seznam JSON objektů, každý reprezentuje jeden okruh z databáze
  \item
    JSON objekt neobsahuj všechny atributy kartičky -
    \texttt{\{id,\ tag\_name\}}
  \end{itemize}
\item
  request \texttt{tag(tag\_id)}

  \begin{itemize}
  \tightlist
  \item
    musí být poslán na url \texttt{localhost:8000/cards/tags/tag\_id/}
  \item
    vrací JSON objekt se všemi informacemi o okruhu specifikovaným
    \texttt{tag\_id}
  \item
    vrací
    \texttt{\{id,\ tag\_name,\ success\_rate,\ card\_count,\ cards\}}
  \end{itemize}
\item
  request \texttt{card(card\_id)}

  \begin{itemize}
  \tightlist
  \item
    musí být poslán na url \texttt{localhost:8000/cards/cards/card\_id/}
  \item
    vrací JSON objekt se všemi informacemi o kartičce specifikované
    \texttt{card\_id}
  \item
    vrací \texttt{\{id,\ card\_front,\ card\_back,\ tag\_count,\ tags\}}
  \end{itemize}
\item
  request \texttt{add\_tag}

  \begin{itemize}
  \tightlist
  \item
    musí být poslán na url \texttt{localhost:8000/cards/add\_tag/}
  \item
    dostane JSON objekt od klienta -
    \texttt{\{type,\ id,\ tag\_name,\ success\_rate,\ card\_count,\ cards\}}

    \begin{itemize}
    \tightlist
    \item
      podle hodnoty \texttt{type} argumentu určí, která akce se provede
    \item
      vytvoří nový okruh (\texttt{type:\ new}),
    \item
      zaktualizuje jméno (\texttt{type:\ update}),
    \item
      zaktualizuje úspěšnost posledního testu (\texttt{type:\ test}),
    \item
      smaže okruh (\texttt{type:\ delete}).
    \end{itemize}
  \end{itemize}
\item
  request \texttt{add\_card}

  \begin{itemize}
  \tightlist
  \item
    musí být poslán na url \texttt{localhost:8000/cards/add\_card/}
  \item
    dostane JSON objekt od klienta -
    \texttt{\{type,\ id,\ card\_front,\ card\_back,\ tag\_count,\ tags\}}

    \begin{itemize}
    \tightlist
    \item
      podle hodnoty \texttt{type} argumentu určí, která akce se provede
    \item
      vytvoří novou kartičku (\texttt{type:\ new}),
    \item
      zaktualizuje jméno a automaticky všechny vazby mezi okruhy
      (\texttt{type:\ update}),
    \item
      smaže kartičku (\texttt{type:\ delete}).
    \end{itemize}
  \end{itemize}
\item
  request \texttt{import\_all}

  \begin{itemize}
  \item
    musí být poslán na url \texttt{localhost:8000/cards/import/}
  \item
    dostane dvojici seznamů JSON objektů, které obsahují okruhy i
    kartičky

    \texttt{{[}}

    ~~~~\texttt{{[}\{type:\ "new",\ card\_front,\ card\_back,\ tag\_count,\ tags\}{]},}

    ~~~~\texttt{{[}\{type:\ "new",\ tag\_name,\ success\_rate:\ 0,\ card\_count:\ 0\}{]}}

    \texttt{{]}}
  \item
    funkce sama určí, jestli je položka unikátní a přidá ji do databáze
    - automaticky spojí okruhy s kartičkami na základě indexů druhého
    listu (v každé \texttt{tags} proměnné je seznam indexů položek z
    druhého listu, které mají být propojeny)
  \item
    když položka již existuje, je přeskočena
  \end{itemize}
\end{itemize}

V souboru \texttt{urls.py} jsou definovány url adresy kam se posílají
jednotlivé requesty. Každý request má svojí adresu pro lepší organizaci.

\hypertarget{klient}{%
\section{Klient}\label{klient}}

Klient uživatelského rozhraní je vytvořeno stejným způsobem jako moderní
webové aplikace, ale místo renderování v prohlížeči jako Firefox nebo
Chrome se vykreslují v Electronu. Výhoda tohoto řešení je lepší
fungování offline a také vytváření vlastního okna pro aplikaci pro hezčí
vzhled, ale na druhou stranu je nezbytné nainstalovat Node.js, což dělá
klienta náročného na úložiště (kolem 100 MB minimálně). Zase ale mohou
být využity ostatní Node.js rozšíření, jako například file manager. Díky
tomu máme přístup k souborům na lokálním disku, čehož by nešlo dosáhnout
s běžnou webovou aplikací, protože Javascript žádnou takovou funkci
neposkytuje.

\hypertarget{sloux17eky-a-soubory}{%
\subsection{Složky a soubory}\label{sloux17eky-a-soubory}}

Všechny soubory jsou umístěny ve složce \texttt{./user\_interface/}.

\begin{itemize}
\tightlist
\item
  \texttt{/assets/} obsahuje obrázky a ikony.
\item
  \texttt{/lib/} obsahuje předkompilované Bootstrap soubory, Jquery a
  speciální CSS soubor, který otáčí kartičkou.
\item
  \texttt{/node\_modules/} obsahuje všechny Node.js package všetně
  Electronu; z těchto souborů se postaví konečný spustitelný soubor
\item
  \texttt{/src/} obsahuje Javascript a HTML soubory, které zajišťují
  funkcionalitu aplikace
\item
  Dále složka obsahuje soubory \texttt{package-lock.json} a
  \texttt{package.json}

  \begin{itemize}
  \tightlist
  \item
    První z těchto dvou popisuje přesný strom souborů stažených do
    node-modules složky
  \item
    Druhý slouží ke spouštění aplikace z terminálu a ke konečnému
    zabalení aplikace do spustitelné formu
  \end{itemize}
\end{itemize}

\hypertarget{structure}{%
\subsection{Structure}\label{structure}}

Konkrétní obsahy jednotlivých souborů jsou popsány v následujících
kapitolách, tady je popsán pouze proces. Vykreslovací proces začíná v
\texttt{render.js} souboru, který je nastaven ke spuštění v
\texttt{package.json}.

Tento soubor vytvoří okno a načte do něj \texttt{mainWindow.html}, který
určuje rozložení a vzhled stránky. Aplikace je postavena jako
jednostránková aplikace, to znamená, že všechny části jsou na jedné
stránce, ale většina je skrytá a zobrazuje se jen ta momentálně potřebná
část. O viditelnost se stará Javascriptový soubor.

Vzhled HTML stránky je vylepšen Bootstrapem. Do \texttt{mainWindow.html}
jsou nalinkovány \texttt{.css} soubory, které jsou upravené oproti těm
oficiálním o některé barvy, \texttt{.js} soubory a \texttt{popper.js},
které jsou potřebné pro některé funkce Bootstrapu.

Do \texttt{mainWindow.htlm} je také nalinkován \texttt{main.js} soubor,
který tvoří jádro aplikace a obsahuje všechny hlavní funkce aplikace.
Například se stará o viditelnost obsahu, získává input od uživatele a
posílá a příjímá requesty z databáze. Všechny jeho funkce jsou popsány v
některé z dalších kapitol.

\hypertarget{instalace-electronu}{%
\subsubsection{Instalace Electronu}\label{instalace-electronu}}

~~~~\texttt{npm\ install\ electron\ -\/-save-dev}

\begin{itemize}
\tightlist
\item
  spuštěno v hlavni složce projektu
\end{itemize}

\hypertarget{instalace-electron-packageru}{%
\subsubsection{Instalace
Electron-packageru}\label{instalace-electron-packageru}}

~~~~\texttt{npm\ install\ electron-packager\ -\/-save-dev}

\begin{itemize}
\tightlist
\item
  spuštěno ve složce, ve které jsou node-modules
\end{itemize}

\hypertarget{spuux161tux11bnuxed-klienta-z-terminuxe1lu}{%
\subsubsection{Spuštění klienta z
terminálu}\label{spuux161tux11bnuxed-klienta-z-terminuxe1lu}}

~~~~\texttt{npm\ start}

\begin{itemize}
\tightlist
\item
  spuštěno ve složce \texttt{user\_interface}
\end{itemize}

\hypertarget{zabalenuxed-aplikace-do-package}{%
\subsubsection{Zabalení aplikace do
package}\label{zabalenuxed-aplikace-do-package}}

Pro zabalení aplikace do složky obsahující spustitelný soubor a vše
potřebné pro spuštění souboru bez instalace spustit

~~~~\texttt{npm\ run} + jedna z možností
\texttt{package-win/package-linux/pakcage-mac}

Tento příkaz je definován v \texttt{package.json} v atributu
\texttt{"scripts":\{\}} a zabalí aplikaci do složky
\texttt{/user\_interface/release-builds/}. Použije k tomu
\texttt{electron-packager} a výsledný package funguje bez instalování
čehokoliv. \textbf{To platí jen pro vizuální stránku aplikace, server
potřebuje mít nainstalované Django a Python a musí být spuštěn z
příkazové řádky (viz Spuštění serveru)}

\hypertarget{render.js}{%
\subsection{render.js}\label{render.js}}

Jednoduchý soubor, popisují se jenom vlastnosti okna a který HTML soubor
se má použít.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Na začátku souboru se musí zahrnout všechny Node.js moduly, které
  budou použity, včetně Electronu a je potřeba příradit mu proměnné
  \texttt{app} a \texttt{BrowserWindow}.
\item
  Vše ostatní by mělo být v bloku
  \texttt{app.on("ready",\ function()\ \{\ code\ \});}, který před
  spuštěním počká až se dokončí načtení modulů a inicializaci okna.
\item
  Vytvořit instanci classy \texttt{BrowserWindow}, kde se nadefinují
  vlastnosti okna.

  \begin{itemize}
  \tightlist
  \item
    Výška, šířka okna (i s minimálními hodnotami, aby byl vidět nějaký
    obsah), kde na obrazovce se má okno zobrazit a nadpis. Je možné
    přidat ještě ikonku, ale to udělá Electron-packager.
  \end{itemize}
\item
  Metodou \texttt{.setMenu} nastavíme lištu menu (v této aplikaci je
  defaultně vypnutá).
\item
  Načtení HTML kódu ze souboru (\texttt{mainWindow.html} v tomto
  případě).
\item
  Na konci je pojistka, aby se vypnula aplikace po zavření všech oken.
\end{enumerate}

Více informací o Electron API a dalších možnostech nastavení je na
\emph{www.electronjs.org/docs}.

\hypertarget{mainwindow.html}{%
\subsection{mainWindow.html}\label{mainwindow.html}}

V hlavičce tohoto souboru je mnoho \texttt{link} a \texttt{script} tagů,
které načítají javascriptová a css rozšíření. V zakomentovaných řádcích
jsou online CDN odkazy pro případ, že by ty stažené soubory přestaly
fungovat (např. kvůli novější verzi). Dále jsou zde dva speciální
\texttt{script} tagy kolem ostatních, aby je Electron správně načetl při
renderování.

Skoro všechny tagy inheritují vlastnosti z \texttt{bootstrap.css} a
obsahují spoustu \texttt{class} atributů. Ty které jsou nějakým způsobem
ovládány Javascriptem jsou také pojmenovány pomocí unikátního
\texttt{id} atributu.

Většina obsahu se generuje dynamicky, takže HTML samo o sobě obsahuje
jen přípravená místa pro naplnění daty z databáze.

Více detailních informací o \texttt{class} atributech je v dokumentaci
Bootstrapu
(\emph{www.getbootstrap.com/docs/4.2/getting-started/introduction/}).

\hypertarget{main.js}{%
\subsection{main.js}\label{main.js}}

Tento soubor obsahuje kombinaci JQuery API a čistého Javascriptu.
Všechny příkazy z JQuery jsou označeny \texttt{\$} a zajišťují lepší
import dat do HTML souboru a také usnadňují komunikaci se serverem.

Po načtení \texttt{mainWindow.html} do Electronu se spustí blok
\texttt{\$(document).ready(function()\ \{\ code\ \});}. Nejprve zavolá
funkci \texttt{reset()}, která skryje vše kromě titulní strany. Poté
čeká na \textbf{click events} na tlačítkách v liště menu a spustí
příslušnou funkci, když \textbf{event} nastane.

\hypertarget{home-button}{%
\subsubsection{Home button}\label{home-button}}

Spustí pouze funkci \texttt{reset()} a zobrazí titulní stranu.

\hypertarget{dalux161uxed-funkce}{%
\subsubsection{Další funkce}\label{dalux161uxed-funkce}}

\begin{itemize}
\tightlist
\item
  \texttt{hide\_all()} - skryje úplně vše, kromě navigační lišty (ta
  skrýt nelze).
\item
  \texttt{reset()} - zavolá \texttt{hide\_all()} a zviditelní titulní
  stranu
\item
  \texttt{show\_one\_item(item)} - bere \texttt{id} objektu jako
  argument; zavolá \texttt{hide\_all()} a zobrazí daný objekt
\item
  \texttt{post\_information(suffix,\ data)} - bere příponu za základní
  adresu k serveru, kam se pošle request, a data k odeslání (v JSON
  formátu) jako argumenty; vytvoří \textbf{ajax POST} request
\item
  \texttt{load\_information(suffix)} - bere příponu za základní adresu k
  serveru jako argument; vytvoří \textbf{ajax GET} request a vrátí
  příchozí data
\item
  \texttt{create\_card\_object(type,\ id,\ card\_front,\ card\_back,\ tags)}

  \begin{itemize}
  \tightlist
  \item
    vytvoří string z JSON objektu (kartička) s hodnotami z argumentů
  \end{itemize}
\item
  \texttt{create\_tag\_object(type,\ id,\ tag\_name,\ success\_rate,\ card\_count,\ cards)}

  \begin{itemize}
  \tightlist
  \item
    vytvoří string z JSON objektu (okruh) s hodnotami z argumentů
  \end{itemize}
\end{itemize}

\hypertarget{click-events}{%
\subsubsection{Click events}\label{click-events}}

\begin{itemize}
\tightlist
\item
  Každý \textbf{click event} musí mít za sebou metodu
  \texttt{.unbind()}, jinak by se příkazy sčítaly a po druhém zmáčknutí
  daného tlačítka by se funkce spustila dvakrát a tak dále.
\item
  Uvnitř každého \textbf{click event}u musí být zavolána funkce
  \texttt{event.preventDefault();}. Jelikož tato aplikace používá JQuery
  pro správu kliknutí, je potřeba zabránit HTML, aby se snažilo reagovat
  na kliknutí. Stránka by se obnovila, protože HTML by nevědělo, co
  dělat, a byla by vidět jen titulní strana.
\end{itemize}
\end{document}